---
description: プロジェクト開始時に必要なルールを自動判定し、プロジェクトフォルダにコピーするルールセレクター。
globs: []
---

# 00. ルールセレクターと環境構築 (Rule Selector & Setup)

- Description: 新規プロジェクト作成時、AI Agentが自律的にルール環境を構築するためのロジックとスクリプトです。

# 1. AI Agent 向け行動プロトコル (Agent Protocol)

Plan Mode または Agent Mode で「新規プロジェクト」または「大規模機能追加」の指示を受けた際、AIは以下の思考プロセスとアクションを**必ず**実行してください。

## Step 1: Analyze (分析)
ユーザーの要求から、プロジェクトの性質（Project Type）を特定します。

- **Frontend**: Next.js, React, Vue, Svelte など
- **Backend**: Node.js, Express, NestJS, Supabase Functions など
- **Fullstack**: Next.js + Supabase, T3 Stack など
- **Infra**: Docker, Terraform, Ansible など
- **AI/CLI**: Pythonスクリプト, MCPサーバー, CLIツール など

## Step 2: Scaffold (土台作成)
まだプロジェクトフォルダが存在しない場合、作成します。

```powershell
mkdir [project-name]; cd [project-name]
```

## Step 3: Install (ルール配置)
特定した Project Type に基づき、マスターの `rules/` ディレクトリから、プロジェクト固有の `.cursor/rules/` ディレクトリへ必要なルールファイルをコピーします。

**選定ロジック（思考ガイド）:**
- **共通必須 (Must)**: `00-index`, `00-mindset`, `01-design-system`, `02-environment`, `22-tool`, `23-security`, `40-architecture`
- **Frontendの場合**: `04-frontend`, `05-react`, `06-component`, `10-qa`, `38-forms`, `39-layout`
- **Backendの場合**: `07-nodejs`, `08-supabase`, `09-api`, `12-docker`, `34-data-modeling`
- **AI機能がある場合**: `29-ai-product`
- **品質重視の場合**: `27-testing`, `28-observability`, `30-nfr`

**実行コマンド例 (PowerShell):**
```powershell
# フォルダ作成
mkdir .cursor/rules -Force

# マスターからのコピー (パスは環境に合わせて調整)
copy C:/Users/石岡大尚/Desktop/Development/.cursor/rules/00-index.mdc .cursor/rules/
copy C:/Users/石岡大尚/Desktop/Development/.cursor/rules/00-mindset.mdc .cursor/rules/
# ...必要なファイルをコピー...
```

## Step 4: Extend (拡張)
コピーしたルールだけではカバーできない固有要件（例: 「今回は UIライブラリに Mantine を使う」など）がある場合、そのための新規ルールファイルを作成します。

- **アクション**: `.cursor/rules/99-project-specific.mdc` を作成し、固有ルールを記述する。

---

# 2. 自動化スクリプト (Legacy Script)

以下は、手動またはスクリプト実行環境で利用するためのPowerShellスクリプトです。AI Agentは上記のプロトコルに従って自律的にコマンドを実行することを推奨しますが、必要に応じてこのスクリプトを参照・実行しても構いません。

```powershell
<#
.SYNOPSIS
    プロジェクトタイプに応じて適切なカーソルルールを選択し、カレントディレクトリにコピーします。

.DESCRIPTION
    このスクリプトは、ユーザーにプロジェクトタイプ（frontend, backend, fullstack, infra, ai-agent-cli）を選択させ、
    それに基づいて必要な .mdc ルールファイルを .cursor/rules ディレクトリに配置します。
    既存のルールがある場合は上書き確認を行います。

.PARAMETER ProjectType
    プロジェクトの種類を指定します (frontend, backend, fullstack, infra, ai-agent-cli)。

.EXAMPLE
    ./setup-cursor-rules.ps1 -ProjectType fullstack
#>

param (
    [Parameter(Mandatory=$true)]
    [ValidateSet("frontend", "fullstack", "backend", "infra", "ai-agent-cli")]
    [string]$ProjectType,

    [string]$RulesSourceDir = "C:\Users\石岡大尚\Desktop\Development\.cursor\rules"
)

# 1. 共通ルール (全てのタイプで必須)
$CommonRules = @(
    "00-index.mdc",
    "00-mindset.mdc",
    "01-design-system.mdc",
    "02-environment-setup.mdc",
    "19-rule-usage-guide.mdc",
    "22-tool-usage-policy.mdc",
    "23-security-policy.mdc",
    "26-implementation-process.mdc",
    "40-architecture-and-layering.mdc"
)

# 2. タイプ別ルール定義
$TypeSpecificRules = @{
    "frontend" = @(
        "03-git-github-workflow.mdc",
        "04-frontend-basics.mdc",
        "05-react-patterns.mdc",
        "06-component-driven-development.mdc",
        "10-frontend-quality-assurance.mdc",
        "11-code-hygiene-and-refactoring.mdc",
        "13-deployment-paas.mdc",
        "37-ux-research-and-ia.mdc",
        "38-forms-validation-and-error-ux.mdc",
        "39-layout-and-responsive-strategy.mdc"
    )

    "backend" = @(
        "03-git-github-workflow.mdc",
        "07-nodejs-best-practices.mdc",
        "08-supabase-rules.mdc",
        "09-integration-and-api-contracts.mdc",
        "11-code-hygiene-and-refactoring.mdc",
        "12-docker-best-practices.mdc",
        "20-gcp-deploy-complete-guide.mdc",
        "27-testing-strategy.mdc",
        "28-observability-and-logging.mdc",
        "34-data-modeling-and-naming.mdc"
    )

    "fullstack" = @(
        "03-git-github-workflow.mdc",
        "04-frontend-basics.mdc",
        "05-react-patterns.mdc",
        "06-component-driven-development.mdc",
        "07-nodejs-best-practices.mdc",
        "08-supabase-rules.mdc",
        "09-integration-and-api-contracts.mdc",
        "10-frontend-quality-assurance.mdc",
        "11-code-hygiene-and-refactoring.mdc",
        "12-docker-best-practices.mdc",
        "13-deployment-paas.mdc",
        "20-gcp-deploy-complete-guide.mdc",
        "27-testing-strategy.mdc",
        "28-observability-and-logging.mdc",
        "30-non-functional-requirements.mdc",
        "31-product-vision-and-problem-framing.mdc",
        "32-functional-requirements-and-usecases.mdc",
        "33-domain-modeling-and-glossary.mdc",
        "34-data-modeling-and-naming.mdc",
        "37-ux-research-and-ia.mdc",
        "38-forms-validation-and-error-ux.mdc",
        "39-layout-and-responsive-strategy.mdc"
    )
    
    "infra" = @(
        "12-docker-best-practices.mdc",
        "20-gcp-deploy-complete-guide.mdc",
        "28-observability-and-logging.mdc",
        "30-non-functional-requirements.mdc"
    )

    "ai-agent-cli" = @(
        "07-nodejs-best-practices.mdc",
        "12-docker-best-practices.mdc",
        "14-scraping-rules.mdc",
        "29-ai-product-rules.mdc"
    )
}

# 3. 実行ロジック
$TargetRules = $CommonRules + $TypeSpecificRules[$ProjectType]
$DestDir = ".cursor/rules"

if (-not (Test-Path $DestDir)) {
    New-Item -ItemType Directory -Path $DestDir -Force | Out-Null
    Write-Host "Created directory: $DestDir" -ForegroundColor Green
}

foreach ($Rule in $TargetRules) {
    $SourcePath = Join-Path $RulesSourceDir $Rule
    $DestPath = Join-Path $DestDir $Rule

    if (Test-Path $SourcePath) {
        Copy-Item -Path $SourcePath -Destination $DestPath -Force
        Write-Host "Installed: $Rule" -ForegroundColor Cyan
    } else {
        Write-Host "Warning: Rule file not found: $Rule" -ForegroundColor Yellow
    }
}

Write-Host "`nSetup complete for project type: $ProjectType" -ForegroundColor Green
```
